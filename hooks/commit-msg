#!/bin/bash

# start commit message check
echo "commit-msg í›…ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤!"

# prefix list
declare -A gitmoji_prefix_list=(
    ["feat"]="âœ¨"
    ["fix"]="ðŸ›" 
    ["refactor"]="ðŸ”¨"
    ["style"]="ðŸ’„"
    ["chore"]="ðŸŽ‰"
    ["wip"]="ðŸš§"
    ["docs"]="ðŸ“š"
    ["test"]="ðŸ“"
    ["devops"]="ðŸ³"
    ["build"]="ðŸ’¡"
    ["hotfix"]="ðŸš‘ï¸"
    ["release"]="ðŸ”–"
    ["deploy"]="ðŸš€"
    ["init"]="ðŸŽ‰"
)

# change prefix to gitmoji
commit_msg=$(cat "$1")
commit_msg_prefix=$(echo "$commit_msg" | cut -d':' -f1 | xargs)
found_prefix=false

for prefix in "${!gitmoji_prefix_list[@]}"; do
    if [ "$commit_msg_prefix" = "$prefix" ]; then
        gitmoji="${gitmoji_prefix_list[$prefix]}"
        new_msg="${gitmoji}"
        found_prefix=true
        if [ "$prefix" = "init" ]; then
            new_msg="${new_msg} $(echo "$commit_msg" | cut -d':' -f2- | xargs)"
            echo "$new_msg" > "$1"
            exit 0
        fi
        break
    fi
done

if [ "$found_prefix" = false ]; then
    echo "ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©"
    echo "í—ˆìš©ëœ ê¹ƒëª¨ì§€ ì ‘ë‘ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìŒê³¼ ê°™ì€ ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”."
    for prefix in "${!gitmoji_prefix_list[@]}"; do
        echo "- $prefix: ${gitmoji_prefix_list[$prefix]}"
    done
    echo "ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©"
    exit 1
fi

# get issue number from branch name
current_branch=$(git symbolic-ref --short HEAD 2>/dev/null)
issue_number=$(echo "$current_branch" | awk -F'/' '{print $NF}' | cut -d'-' -f1,2)

# if can't find issue number
if [ -z "$issue_number" ]; then
    echo "ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©"
    echo "ì´ìŠˆ ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    echo "ë¸Œëžœì¹˜ ì´ë¦„ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."
    echo "ì˜ˆì‹œ: feature/JIRA-1234-branch-name"
    echo "ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©ðŸ’©"
    exit 1
fi

# add issue number to commit message
new_msg="${new_msg} [JIRA-$issue_number] $(echo "$commit_msg" | cut -d':' -f2- | xargs)"
echo "$new_msg" > "$1"

exit 0
